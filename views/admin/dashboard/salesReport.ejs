<form action="/admin/salesReport/filter" method="POST" class="mb-3">
  <select name="rangeType" id="rangeType" class="form-select" onchange="toggleDateInputs()">
    <option value="today">Today</option>
    <option value="week">This Week</option>
    <option value="month">This Month</option>
    <option value="custom">Custom Date Range</option>
  </select>

  <div id="customDateInputs" style="display: none;">
    <input type="date" name="startDate" class="form-control mt-2" >
    <input type="date" name="endDate" class="form-control mt-2" >
  </div>

  <button type="submit" class="btn btn-primary mt-3">Generate Report</button>
</form>

<% if (report) { %>
  <div class="mb-3">
    <a href="/admin/salesReport/download/pdf?rangeType=<%=report.rangeType%>&startDate=<%=report.startDate%>&endDate=<%=report.endDate%>" class="btn btn-danger">Download PDF</a>
    <a href="/admin/salesReport/download/excel?rangeType=<%=report.rangeType%>&startDate=<%=report.startDate%>&endDate=<%=report.endDate%>" class="btn btn-success">Download Excel</a>
  </div>

  <div class="card p-3">
    <h5>Summary</h5>
    <p>Total Orders: <%=report.totalSales%></p>
    <p>Total Amount: ₹<%=report.totalAmount%></p>
    <p>Total Discount: ₹<%=report.totalDiscount%></p>
  </div>
  <div id="reportContainer">
    <%- include('../../partials/admin/salesReportTable') %>
  </div>
  


<% } else { %>
  <h4>No reports to display</h4>
<% } %>


<script>
  function toggleDateInputs() {
    const rangeType = document.getElementById('rangeType').value;
    const start = document.getElementById('startDate');
    const end = document.getElementById('endDate');
    const customInputs = document.getElementById('customDateInputs');

    if (rangeType === 'custom') {
      customInputs.style.display = 'block';
      start.required = true;
      end.required = true;
    } else {
      customInputs.style.display = 'none';
      start.required = false;
      end.required = false;
    }
  }
</script>
<script>
  document.addEventListener("click", async (e) => {
    if (e.target.classList.contains("page-btn")) {
      e.preventDefault();

      const page = e.target.dataset.page;
      const rangeType = "<%= report.rangeType %>";
      const startDate = "<%= report.startDate %>";
      const endDate = "<%= report.endDate %>";

      try {
        const response = await fetch(`/admin/salesReport/filter?page=${page}`, {
          method: "POST",
          headers: { "Content-Type": "application/json", "X-Requested-With": "XMLHttpRequest" },
          body: JSON.stringify({ rangeType, startDate, endDate })
        });

        const html = await response.text();
        document.getElementById("reportContainer").innerHTML = html;
      } catch (err) {
        console.error("Pagination failed:", err);
      }
    }
  });
</script>
